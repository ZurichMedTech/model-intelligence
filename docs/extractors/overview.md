# Extractors Overview

## What are Extractors?

Extractors are components of the S4L Plugin Framework that enable visualization and analysis of simulation results. They take raw simulation output data and transform it into meaningful visual representations and quantitative metrics that help users understand the physics being simulated.

An extractor is essentially a post-processing engine that runs after your simulation completes and performs several key functions:

1. **Data Loading**: Loads result files generated by your solver
2. **Data Processing**: Processes raw data into visualization-ready formats
3. **Visualization Creation**: Creates various visualization objects (fields, isosurfaces, streamlines, etc.)
4. **User Interaction**: Provides interactive controls for exploring and analyzing results
5. **Quantitative Analysis**: Computes statistics and metrics from simulation data

## The Extractor Pipeline

When a user views simulation results in S4L, the following pipeline is executed:

```
Solver Output Files → Extractor Loading → Data Processing → Visualization → UI Controls
```

This process begins automatically when a user opens simulation results in the S4L interface. The extractor is responsible for everything from the second step onward.

## Types of Visualization

Extractors can create various types of visualization objects:

- **Scalar Fields**: Visualize temperature, pressure, concentration, or other scalar quantities
- **Vector Fields**: Display flow velocity, electric fields, or other vector quantities
- **Isosurfaces**: Show surfaces of constant value (e.g., temperature)
- **Streamlines**: Illustrate the path of particles through vector fields
- **Cut Planes**: Create 2D slices through 3D data
- **Animations**: Show time-dependent evolution of physical phenomena

## Extractor Integration with S4L

Extractors are registered with S4L through a specific API and are automatically discovered when a user loads results from your simulation. The key integration points are:

1. **Entry Point**: A function that creates and returns an extractor engine
2. **Parameter Handling**: Methods for receiving visualization parameters
3. **Extraction Process**: The main algorithm that produces visualization objects
4. **UI Controls**: Property panels that allow users to customize visualizations

## Extractor Components

A typical extractor consists of several key components:

### Entry Point

The entry point is a function named `create_engine` that S4L calls to create an instance of your extractor:

```python
import s4l_core.postprocessing as pp

def create_engine():
    """Entry point called by S4L when loading results."""
    return MyPluginExtractor()
```

### Extractor Class

The main class that implements the extraction functionality:

```python
class MyPluginExtractor:
    def __init__(self):
        """Initialize the extractor with default settings."""
        # Default settings
        self.visualization_settings = {}
        
        # Path to results
        self.result_path = None
        
        # List of visualization objects
        self.fields = []
    
    def set_parameters(self, params):
        """Set extraction parameters based on UI input."""
        # Get settings from UI
        self.result_path = params.GetString("ResultPath")
        # ... other parameters
    
    def extract(self):
        """Main extraction function."""
        # Load and process data
        # Create visualization objects
        # Return the list of objects
        return self.fields
```

### UI Property Panel

A method that defines the user interface controls:

```python
def get_ui_panel(self):
    """Create a property panel for controlling the extractor."""
    panel = pp.PyPropertyGroup()
    panel.Name = "Visualization Settings"
    
    # Add controls for visualization settings
    # ...
    
    return panel
```

### Event Handling

Methods for handling user interactions:

```python
def handle_events(self, event_name, event_data):
    """Handle UI events."""
    # Process events and update visualizations
    # ...
    
    # Return True if the visualization should be updated
    return True
```

## Extractor Workflow

The typical workflow when developing an extractor is:

1. **Create the Module**: Set up the Python module for your extractor
2. **Implement the Entry Point**: Create the `create_engine` function
3. **Define the Extractor Class**: Implement the main extraction logic
4. **Create Loading Functions**: Implement functions to load solver output
5. **Define Visualization Methods**: Create functions for different visualization types
6. **Add UI Controls**: Create property panels for user interaction
7. **Implement Analysis Tools**: Add functions for quantitative analysis
8. **Test and Refine**: Test the extractor with real solver output

## Best Practices

When developing extractors, follow these best practices:

- **Memory Management**: Use efficient data structures and algorithms for large datasets
- **Error Handling**: Implement robust error handling to gracefully handle missing or corrupted data
- **User Experience**: Design intuitive UI controls with descriptive labels
- **Performance**: Optimize visualization for interactive performance
- **Configurability**: Make visualization parameters configurable for different use cases
- **Documentation**: Document the meaning and units of visualized quantities
- **Visual Design**: Use appropriate color maps and scales for different physical quantities

## VTK and S4L Visualization

The Visualization Toolkit (VTK) is the core technology used for visualization in S4L. An understanding of VTK is essential for developing effective extractors. VTK provides:

- **Data Structures**: Efficient representation of grid and point-based data
- **Visualization Algorithms**: Ready-made algorithms for common visualization tasks
- **Rendering Pipeline**: High-quality 3D rendering of complex scenes
- **Filters**: Data processing operations like isosurface extraction
- **Interaction Tools**: Widgets for user interaction with 3D data

For more details on using VTK in your extractors, see the [VTK Integration](vtk-integration.md) guide.

## Typical Extractor Structure

A typical extractor module (`simulation_extractor.py`) has the following structure:

```
import os
import vtk
import numpy as np
import s4l_core.postprocessing as pp
from s4l_core.postprocessing.fieldTypes import FieldType

def create_engine():
    """Entry point function."""
    return MySimulationExtractor()

class MySimulationExtractor:
    """Main extractor class."""
    
    def __init__(self):
        """Initialize settings."""
        # ...
    
    def set_parameters(self, params):
        """Set extraction parameters."""
        # ...
    
    def extract(self):
        """Main extraction function."""
        # ...
    
    def load_results(self):
        """Load result files."""
        # ...
    
    def create_visualization_objects(self):
        """Create visualization objects."""
        # ...
    
    def get_ui_panel(self):
        """Create UI controls."""
        # ...
    
    def handle_events(self, event_name, event_data):
        """Handle UI events."""
        # ...
    
    # Helper methods for specific visualizations
    def create_field(self, ...):
        """Create a field visualization."""
        # ...
    
    def create_isosurface(self, ...):
        """Create an isosurface."""
        # ...
```

## Next Steps

To learn more about developing extractors for your S4L plugin:

- [Creating an Extractor](creating-extractor.md): A detailed guide to implementing extractors
- [VTK Integration](vtk-integration.md): Learn how to use VTK effectively in your extractors
- [Advanced Visualization](../advanced-topics/advanced-visualization.md): Advanced visualization techniques